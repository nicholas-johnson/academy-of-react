<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demo 2 - Virtual DOM Speed</title>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        min-height: 100vh;
        color: #eee;
      }
      h1 {
        text-align: center;
        color: #00d9ff;
        margin-bottom: 10px;
      }
      .subtitle {
        text-align: center;
        color: #888;
        margin-bottom: 30px;
      }
      .controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }
      button {
        padding: 12px 20px;
        font-size: 14px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition:
          transform 0.1s,
          box-shadow 0.1s;
      }
      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      }
      button:active {
        transform: translateY(0);
      }
      .btn-dom {
        background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
        color: white;
      }
      .btn-react {
        background: linear-gradient(135deg, #00d9ff, #0099cc);
        color: white;
      }
      .btn-change-one {
        background: linear-gradient(135deg, #4ade80, #22c55e);
        color: white;
      }
      .btn-regenerate {
        background: linear-gradient(135deg, #a855f7, #7c3aed);
        color: white;
      }
      .highlight-section {
        background: rgba(74, 222, 128, 0.1);
        border: 2px solid #4ade80;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        text-align: center;
      }
      .highlight-section h3 {
        color: #4ade80;
        margin-top: 0;
      }
      .highlight-section p {
        color: #888;
        margin-bottom: 15px;
      }
      .results {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }
      .result-panel {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .result-panel h2 {
        margin-top: 0;
        font-size: 18px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .result-panel.dom h2 {
        color: #ff6b6b;
      }
      .result-panel.react h2 {
        color: #00d9ff;
      }
      .timing {
        font-size: 14px;
        color: #888;
        margin-bottom: 10px;
        min-height: 20px;
      }
      .timing.fast {
        color: #4ade80;
      }
      .timing.slow {
        color: #f87171;
      }
      .dom-changes {
        font-size: 13px;
        color: #fbbf24;
        margin-bottom: 15px;
        min-height: 18px;
      }
      .list-container {
        max-height: 350px;
        overflow-y: auto;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        padding: 10px;
      }
      ol {
        margin: 0;
        padding-left: 30px;
      }
      li {
        padding: 4px 0;
        font-family: "Consolas", "Monaco", monospace;
        font-size: 14px;
        transition: background-color 0.3s;
      }
      li.changed {
        background: rgba(74, 222, 128, 0.3);
        animation: flash 1s ease-out;
      }
      @keyframes flash {
        0% {
          background: rgba(74, 222, 128, 0.8);
        }
        100% {
          background: rgba(74, 222, 128, 0.3);
        }
      }
      .console-hint {
        background: rgba(168, 85, 247, 0.1);
        border: 1px solid rgba(168, 85, 247, 0.3);
        border-radius: 8px;
        padding: 15px;
        margin-top: 20px;
      }
      .console-hint h3 {
        margin-top: 0;
        color: #a855f7;
      }
      .console-hint code {
        background: rgba(0, 0, 0, 0.3);
        padding: 2px 6px;
        border-radius: 4px;
        font-family: "Consolas", "Monaco", monospace;
      }
      .console-hint pre {
        background: rgba(0, 0, 0, 0.3);
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
        font-size: 13px;
      }
      .stats {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }
      .stat-box {
        background: rgba(255, 255, 255, 0.05);
        padding: 12px 20px;
        border-radius: 8px;
        text-align: center;
      }
      .stat-box .label {
        font-size: 11px;
        color: #888;
        text-transform: uppercase;
      }
      .stat-box .value {
        font-size: 20px;
        font-weight: bold;
        color: #00d9ff;
      }
      .stat-box .value.dom-color {
        color: #ff6b6b;
      }
      .stat-box .value.react-color {
        color: #00d9ff;
      }
      .explanation {
        background: rgba(0, 217, 255, 0.1);
        border: 1px solid rgba(0, 217, 255, 0.3);
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
      }
      .explanation h3 {
        margin-top: 0;
        color: #00d9ff;
      }
      .explanation ul {
        margin: 0;
        padding-left: 20px;
      }
      .explanation li {
        background: none;
        font-family: inherit;
        font-size: 14px;
        padding: 5px 0;
      }
    </style>
  </head>
  <body>
    <h1>‚ö° Virtual DOM Speed Comparison</h1>
    <p class="subtitle">See why React's Virtual DOM approach is efficient</p>

    <div class="explanation">
      <h3>How This Works</h3>
      <ul>
        <li>
          <strong>Traditional DOM:</strong> Rebuilds the ENTIRE list from
          scratch every time
        </li>
        <li>
          <strong>React Virtual DOM:</strong> Compares old vs new, only updates
          what changed
        </li>
        <li>
          <strong>Key insight:</strong> Change ONE value, then render both ‚Äî
          watch the difference!
        </li>
      </ul>
    </div>

    <div class="stats">
      <div class="stat-box">
        <div class="label">Items</div>
        <div class="value" id="array-size">0</div>
      </div>
      <div class="stat-box">
        <div class="label">DOM Time</div>
        <div class="value dom-color" id="dom-time">-</div>
      </div>
      <div class="stat-box">
        <div class="label">React Time</div>
        <div class="value react-color" id="react-time">-</div>
      </div>
      <div class="stat-box">
        <div class="label">DOM Nodes Changed</div>
        <div class="value dom-color" id="dom-changes">-</div>
      </div>
      <div class="stat-box">
        <div class="label">React Nodes Changed</div>
        <div class="value react-color" id="react-changes">-</div>
      </div>
    </div>

    <div class="highlight-section">
      <h3>üî¨ The Key Test: Change One Value</h3>
      <p>Click this after initial render to see React's diffing in action</p>
      <button class="btn-change-one" onclick="changeOneValue()">
        ‚úèÔ∏è Change Random Value ‚Üí Then Render Both
      </button>
    </div>

    <div class="controls">
      <button class="btn-dom" onclick="renderWithDOM()">
        üî® Render with DOM
      </button>
      <button class="btn-react" onclick="renderWithReact()">
        ‚öõÔ∏è Render with React
      </button>
      <button class="btn-regenerate" onclick="regenerateNumbers()">
        üé≤ New Random Numbers
      </button>
    </div>

    <div class="results">
      <div class="result-panel dom">
        <h2>üî® Traditional DOM</h2>
        <div class="timing" id="dom-timing"></div>
        <div class="dom-changes" id="dom-changes-text"></div>
        <div class="list-container">
          <ol id="dom-list"></ol>
        </div>
      </div>
      <div class="result-panel react">
        <h2>‚öõÔ∏è React Virtual DOM</h2>
        <div class="timing" id="react-timing"></div>
        <div class="dom-changes" id="react-changes-text"></div>
        <div class="list-container" id="react-root"></div>
      </div>
    </div>

    <div class="console-hint">
      <h3>üéÆ Try it in the Console!</h3>
      <p>
        The <code>items</code> array is exposed globally. Open DevTools (F12)
        and try:
      </p>
      <pre>
// Change a single value (then click render buttons)
items[0].value = 999999;

// Change multiple values
items[5].value = 11111;
items[10].value = 22222;

// Make a huge array
items = Array.from({ length: 5000 }, (_, i) => ({ id: i, value: Math.floor(Math.random() * 10000) }));</pre
      >
    </div>

    <script>
      // ============================================
      // GLOBAL DATA with STABLE IDs (crucial for React keys!)
      // ============================================
      let nextId = 0;

      const createItems = (count) =>
        Array.from({ length: count }, () => ({
          id: nextId++,
          value: Math.floor(Math.random() * 10000),
        }));

      window.items = createItems(100000);

      // Track what changed for visualization
      let lastRenderedItems = null;
      let changedIndices = new Set();

      const updateArraySize = () => {
        document.getElementById("array-size").textContent =
          items.length.toLocaleString();
      };
      updateArraySize();

      // ============================================
      // TRADITIONAL DOM RENDERING
      // Always rebuilds everything from scratch
      // ============================================
      const renderWithDOM = () => {
        const list = document.getElementById("dom-list");
        const timingEl = document.getElementById("dom-timing");
        const statEl = document.getElementById("dom-time");
        const changesStatEl = document.getElementById("dom-changes");
        const changesTextEl = document.getElementById("dom-changes-text");

        const start = performance.now();

        // ALWAYS clear and rebuild everything - this is the problem!
        list.innerHTML = "";

        for (let i = 0; i < items.length; i++) {
          const li = document.createElement("li");
          li.textContent = items[i].value.toLocaleString();
          if (changedIndices.has(i)) {
            li.className = "changed";
          }
          list.appendChild(li);
        }

        const end = performance.now();
        const time = (end - start).toFixed(2);

        // DOM always changes ALL nodes
        const nodesChanged = items.length;

        timingEl.textContent = `Rendered in ${time}ms`;
        timingEl.className =
          "timing " + (parseFloat(time) > 50 ? "slow" : "fast");
        statEl.textContent = time + "ms";
        changesStatEl.textContent = nodesChanged.toLocaleString();
        changesTextEl.textContent = `Rebuilt ALL ${nodesChanged.toLocaleString()} DOM nodes`;

        updateArraySize();
      };

      // ============================================
      // REACT VIRTUAL DOM RENDERING
      // Only updates what actually changed!
      // ============================================
      const reactRoot = ReactDOM.createRoot(
        document.getElementById("react-root"),
      );
      let reactRenderedOnce = false;

      const renderWithReact = () => {
        const timingEl = document.getElementById("react-timing");
        const statEl = document.getElementById("react-time");
        const changesStatEl = document.getElementById("react-changes");
        const changesTextEl = document.getElementById("react-changes-text");

        const start = performance.now();

        // Create React elements with STABLE keys (item.id, not index!)
        const listItems = items.map((item, index) =>
          React.createElement(
            "li",
            {
              key: item.id, // Stable ID - React can track this across renders!
              className: changedIndices.has(index) ? "changed" : "",
            },
            item.value.toLocaleString(),
          ),
        );

        const list = React.createElement("ol", null, listItems);

        // React's render() diffs against previous render
        reactRoot.render(list);

        const end = performance.now();
        const time = (end - start).toFixed(2);

        // Calculate how many nodes React actually needed to update
        let nodesChanged;
        if (!reactRenderedOnce) {
          nodesChanged = items.length; // First render creates all nodes
          reactRenderedOnce = true;
        } else {
          nodesChanged = changedIndices.size || 0; // Subsequent renders only update changed
        }

        timingEl.textContent = `Rendered in ${time}ms`;
        timingEl.className =
          "timing " + (parseFloat(time) > 50 ? "slow" : "fast");
        statEl.textContent = time + "ms";
        changesStatEl.textContent = nodesChanged.toLocaleString();

        if (nodesChanged === items.length) {
          changesTextEl.textContent = `Initial render: created ${nodesChanged.toLocaleString()} nodes`;
        } else if (nodesChanged === 0) {
          changesTextEl.textContent = `No changes detected - 0 DOM updates!`;
        } else {
          changesTextEl.textContent = `Only updated ${nodesChanged} node(s) via diffing!`;
        }

        updateArraySize();
      };

      // ============================================
      // CHANGE ONE VALUE - The key demonstration!
      // ============================================
      const changeOneValue = () => {
        // Pick a random index
        const randomIndex = Math.floor(Math.random() * items.length);
        const oldValue = items[randomIndex].value;
        const newValue = Math.floor(Math.random() * 10000);

        // Change the value (keeping the same id!)
        items[randomIndex].value = newValue;

        // Track what changed for visualization
        changedIndices.clear();
        changedIndices.add(randomIndex);

        console.log(`Changed items[${randomIndex}]: ${oldValue} ‚Üí ${newValue}`);

        // Render both to compare
        renderWithDOM();
        renderWithReact();

        // Clear highlight after animation
        setTimeout(() => {
          changedIndices.clear();
        }, 1500);
      };

      // ============================================
      // REGENERATE ALL NUMBERS
      // ============================================
      const regenerateNumbers = () => {
        window.items = createItems(items.length);
        changedIndices.clear();
        reactRenderedOnce = false;
        lastRenderedItems = null;

        updateArraySize();

        // Clear both panels
        document.getElementById("dom-list").innerHTML = "";
        document.getElementById("dom-timing").textContent = "";
        document.getElementById("dom-changes-text").textContent = "";
        document.getElementById("dom-time").textContent = "-";
        document.getElementById("dom-changes").textContent = "-";

        reactRoot.render(null);
        document.getElementById("react-timing").textContent = "";
        document.getElementById("react-changes-text").textContent = "";
        document.getElementById("react-time").textContent = "-";
        document.getElementById("react-changes").textContent = "-";
      };

      // ============================================
      // INITIAL SETUP
      // ============================================
      console.log(
        "%c‚ö° Virtual DOM Demo",
        "font-size: 20px; font-weight: bold; color: #00d9ff;",
      );
      console.log('%cThe "items" array is available globally.', "color: #888;");
      console.log(
        "%cTry: items[0].value = 999999; then click the render buttons",
        "color: #4ade80;",
      );
    </script>
  </body>
</html>
